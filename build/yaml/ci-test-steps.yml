#variables:
#  DotNetCoverallsToken: define this in Azure
#  NoCoverageUpload: (optional) define this in Azure. Default = false.
steps:
- task: PublishBuildArtifacts@1
  displayName: 'Publish build artifact CodeCoverage'
  inputs:
    PathtoPublish: CodeCoverage
    ArtifactName: CodeCoverage
  enabled: false

- powershell: |
   New-Item -ItemType directory -Path "outputLibraries\" -Force
   
   $buildTarget = $env:BuildConfiguration.Split("-")[0];
   
   $env:BotBuilderDll.Split(",") | ForEach {
       $library = $_.Trim()
       Write-Host $library
   
       Get-ChildItem -Path "*/$library/bin/$buildTarget/netstandard2.0/$library.dll" -Recurse | Copy-Item -Destination 'outputLibraries\' -Force
       Get-ChildItem -Path "*/*/$library/bin/$buildTarget/netstandard2.0/$library.dll" -Recurse | Copy-Item -Destination 'outputLibraries\' -Force
   }
  displayName: 'Copy DLLs to outputLibraries folder'

- task: PublishPipelineArtifact@0
  displayName: 'Publish Microsoft.Bot.Builder DLLs artifact'
  inputs:
    artifactName: 'BotBuilderDLLs-$(BuildConfiguration)'
    targetPath: outputLibraries
